<!DOCTYPE html>
<html lang="de">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Dashboard - {{ user.username }}</title>
    <link
      href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css"
      rel="stylesheet"
    />
    <style>
      body {
        background-color: #f8f9fa;
        font-family: "Segoe UI", Tahoma, Geneva, Verdana, sans-serif;
      }
      .dashboard-container {
        max-width: 1200px;
        margin: 30px auto;
        padding: 20px;
      }
      .header {
        display: flex;
        justify-content: space-between;
        align-items: center;
        margin-bottom: 30px;
        padding-bottom: 15px;
        border-bottom: 1px solid #eee;
      }
      .book-card {
        background-color: white;
        border-radius: 8px;
        box-shadow: 0 2px 4px rgba(0, 0, 0, 0.05);
        padding: 20px;
        margin-bottom: 20px;
      }
      .overdue {
        background-color: #fff5f5;
        border-left: 4px solid #dc3545;
      }
      .due-soon {
        background-color: #fff9f0;
        border-left: 4px solid #fd7e14;
      }
      .btn-logout {
        color: #dc3545;
        border: 1px solid #dc3545;
      }
      .btn-logout:hover {
        background-color: #dc3545;
        color: white;
      }
      .days-left {
        font-weight: bold;
      }
      .overdue-text {
        color: #dc3545;
      }
    </style>
  </head>
  <body>
    <div class="dashboard-container">
      <div class="header">
        <h1>Hallo, {{ user.username }}!</h1>
        <a href="/logout" class="btn btn-outline-danger btn-logout">
          <i class="bi bi-box-arrow-right"></i> Logout
        </a>
      </div>

      <h2 class="mb-4">Deine Bücher</h2>

      {% if books|length == 0 %}
      <div class="alert alert-info">
        Du hast aktuell keine Bücher in deiner Liste.
      </div>
      {% else %}
      <div class="table-responsive">
        <table class="table table-hover">
          <thead class="table-light">
            <tr>
              <th>Titel</th>
              <th>Autor</th>
              <th>Fällig am</th>
              <th>Status</th>
            </tr>
          </thead>
          <tbody>
            {% for book in books %}
            <tr
              class="{% if book.days_left is not none and book.days_left < 0 %}table-danger{% elif book.days_left is not none and book.days_left < 3 %}table-warning{% endif %}"
            >
              <td>{{ book.title }}</td>
              <td>{{ book.authors }}</td>
              <td>{{ book.due if book.due else '-' }}</td>
              <td>
                {% if book.days_left is not none %}
                <span
                  class="days-left {% if book.days_left < 0 %}overdue-text{% endif %}"
                >
                  {% if book.days_left < 0 %} Überfällig ({{ -book.days_left }}
                  Tage) {% else %} Noch {{ book.days_left }} Tage {% endif %}
                </span>
                {% else %} - {% endif %}
              </td>
            </tr>
            {% endfor %}
          </tbody>
        </table>
      </div>

      <div class="mt-4">
        <div class="alert alert-secondary">
          <strong>Statistik:</strong>
          {{ books|length }} Bücher insgesamt | {% set overdue_books =
          books|selectattr('days_left', 'defined')|selectattr('days_left', '<',
          0)|list|length %} {{ overdue_books }} überfällig
        </div>
      </div>
      {% endif %}
    </div>

    <!-- Bootstrap Icons -->
    <link
      rel="stylesheet"
      href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.10.0/font/bootstrap-icons.css"
    />
    <!-- Bootstrap JS Bundle -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
  </body>
</html>
